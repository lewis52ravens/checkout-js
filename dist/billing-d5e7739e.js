(window.webpackJsonpCheckout=window.webpackJsonpCheckout||[]).push([[5],{1387:function(e,t,a){"use strict";var s=a(28),n=a(38),o=a.n(n),r=a(0),i=a.n(r),l=a(421),c=a(419);const d=Object(r.forwardRef)((e,t)=>{var{additionalClassName:a,label:n,id:r}=e,d=Object(s.__rest)(e,["additionalClassName","label","id"]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(l.a,Object.assign({},d,{className:o()("form-checkbox","optimizedCheckout-form-checkbox",a),id:r,ref:t,type:"checkbox"})),i.a.createElement(c.a,{htmlFor:r},n))});t.a=d},1402:function(e,t,a){"use strict";var s=a(28),n=a(38),o=a.n(n),r=a(0),i=a.n(r);const l=Object(r.forwardRef)((e,t)=>{var{additionalClassName:a,testId:n,className:r}=e,l=Object(s.__rest)(e,["additionalClassName","testId","className"]);return i.a.createElement("textarea",Object.assign({},l,{className:r||o()("form-input","optimizedCheckout-form-input",a),"data-test":n,ref:t}))});t.a=l},1410:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a(12);function n(e,t){return!(!e||!t)&&(Object(s.isEqual)(o(e),o(t))&&function(e,t){if(e.stateOrProvince&&e.stateOrProvince===t.stateOrProvince)return!0;if(e.stateOrProvinceCode&&e.stateOrProvinceCode===t.stateOrProvinceCode)return!0;return e.stateOrProvince===t.stateOrProvince&&e.stateOrProvinceCode===t.stateOrProvinceCode}(e,t))}function o(e){return Object(s.omit)(Object.assign(Object.assign({},e),{customFields:(e.customFields||[]).filter(({fieldValue:e})=>!!e)}),["id","shouldSaveAddress","stateOrProvince","stateOrProvinceCode","type","email","country"])}},1414:function(e,t,a){},1450:function(e,t,a){},1456:function(e,t,a){},1457:function(e,t,a){},1458:function(e,t,a){},1459:function(e,t,a){},1470:function(e,t,a){"use strict";var s=a(12),n=a(0),o=a.n(n),r=a(426),i=a(1387),l=a(423);t.a=Object(n.memo)(({additionalClassName:e,disabled:t=!1,labelContent:a,onChange:c,name:d,id:m})=>{const u=Object(n.useCallback)(({field:e})=>o.a.createElement(n.Fragment,null,o.a.createElement(i.a,Object.assign({},e,{checked:!!e.value,disabled:t,id:m||e.name,label:a})),o.a.createElement(l.a,{name:d,testId:Object(s.kebabCase)(d)+"-field-error-message"})),[t,m,a,d]);return o.a.createElement(r.a,{additionalClassName:e,name:d,onChange:c,render:u})})},1471:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a(444);function n(e){return Object(s.a)(e.lineItems.physicalItems.filter(e=>!e.addedByPromotion))}},1507:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var s=a(12);function n(e){const t=[];return Object(s.forIn)(e,(e,a)=>{let n;if(Object(s.isDate)(e)){const t=Object(s.padStart)((e.getMonth()+1).toString(),2,"0"),a=Object(s.padStart)(e.getDate().toString(),2,"0");n=`${e.getFullYear()}-${t}-${a}`}else n=e;t.push({fieldId:a,fieldValue:n})}),t}},1508:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(0),n=a.n(s),o=a(1400);class r extends s.Component{constructor(){super(...arguments),this.state={shouldShow:!1},this.handleClick=e=>{const{shouldShow:t}=this.state;t?this.handleClose(e.nativeEvent):this.handleOpen(e.nativeEvent)},this.handleOpen=()=>{const{shouldShow:e}=this.state;e||this.setState({shouldShow:!0},()=>{document.addEventListener("click",this.handleClose)})},this.handleClose=()=>{const{shouldShow:e}=this.state;e&&this.setState({shouldShow:!1},()=>{document.removeEventListener("click",this.handleClose)})}}componentWillUnmount(){document.removeEventListener("click",this.handleClose)}render(){const{children:e,placement:t,dropdown:a}=this.props,{shouldShow:s}=this.state;return n.a.createElement(o.Manager,null,n.a.createElement(o.Reference,null,({ref:t})=>n.a.createElement("div",{className:"dropdownTrigger",onClick:this.handleClick,ref:t},e)),n.a.createElement(o.Popper,{modifiers:{hide:{enabled:!1},flip:{enabled:!1},preventOverflow:{enabled:!1}},placement:t},({ref:e,style:t})=>s?n.a.createElement("div",{className:"dropdownMenu",ref:e,style:Object.assign(Object.assign({},t),{width:"100%",zIndex:1})},a):null))}}r.defaultProps={placement:"bottom-start"}},1640:function(e,t,a){"use strict";var s=a(85),n=a(12),o=a(0),r=a.n(o),i=a(416),l=a(292),c=a(180),d=a(1367),m=a(1644),u=a(1470);const h={address1:"addressLine1",address2:"addressLine2",postalCode:"postCode",stateOrProvince:"province",stateOrProvinceCode:"provinceCode"};function p(e){return""+(h[e]||e)}function g(e){return p(e)+"Input"}class b{constructor(e){const{address_components:t,name:a}=e;this._name=a,this._address=t}getState(){return this._get("administrative_area_level_1","short_name")}getStreet(){return this._name}getStreet2(){return""}getCity(){return this._get("postal_town","long_name")||this._get("locality","long_name")||this._get("neighborhood","short_name")}getCountry(){return this._get("country","short_name")}getPostCode(){return this._get("postal_code","short_name")}_get(e,t){const a=this._address&&this._address.find(t=>-1!==t.types.indexOf(e));return a?a[t]:""}}class f extends b{getState(){return this._get("administrative_area_level_2","long_name")}getStreet2(){return this._get("locality","long_name")}}function C(e,t=[]){if(!e||!e.address_components)return{};const a=class{static create(e){const t=new b(e);switch(t.getCountry()){case"GB":return new f(e)}return t}}.create(e),s=a.getState(),n=a.getCountry(),o=t&&t.find(e=>n===e.code),r=a.getStreet2();return Object.assign({address2:r,city:a.getCity(),countryCode:n,postalCode:a.getPostCode()},s?function(e,t=[]){const a=t.find(({code:t,name:a})=>t===e||a===e);if(!a)return{stateOrProvince:t.length?"":e,stateOrProvinceCode:""};return{stateOrProvince:a.name,stateOrProvinceCode:a.code}}(s,o&&o.subdivisions):{})}var v=a(1340),O=a(419),E=a(1519),j=a.n(E);a(1458);var y=({children:e})=>r.a.createElement("div",{className:"popover"},e);a(1459);function _(e,t){const a=["popoverList-item"];return e===t&&a.push("is-active"),a.join(" ")}var S=Object(o.memo)(({highlightedIndex:e=-1,testId:t,getItemProps:a=(e=>e),menuProps:s={},items:n})=>n&&n.length?r.a.createElement("ul",Object.assign({className:"popoverList","data-test":t},s),n.map((s,n)=>r.a.createElement("li",Object.assign({className:_(e,n),"data-test":t&&t+"-item"},a({key:s.id,index:n,item:s}),{key:n}),s.content))):null);class A extends o.PureComponent{constructor(){super(...arguments),this.stateReducer=(e,t)=>{const{onChange:a}=this.props;switch(t.type){case j.a.stateChangeTypes.blurInput:case j.a.stateChangeTypes.blurButton:case j.a.stateChangeTypes.mouseUp:case j.a.stateChangeTypes.touchEnd:return Object.assign(Object.assign({},t),{inputValue:e.inputValue});case j.a.stateChangeTypes.changeInput:return t.inputValue!==e.inputValue&&a&&a(t.inputValue||"",e.isOpen),t;case j.a.stateChangeTypes.keyDownEnter:default:return t}},this.handleStateChange=({isOpen:e,inputValue:t})=>{const{onToggleOpen:a=n.noop}=this.props;void 0!==e&&a({isOpen:e,inputValue:t||""})}}render(){const{inputProps:e,initialValue:t,initialHighlightedIndex:a,items:s,children:o,onSelect:i,listTestId:l}=this.props;return r.a.createElement(j.a,{defaultHighlightedIndex:0,initialHighlightedIndex:a,initialInputValue:t,itemToString:this.itemToString,labelId:e&&e["aria-labelledby"]?e["aria-labelledby"]:null,onChange:i,onStateChange:this.handleStateChange,stateReducer:this.stateReducer},({isOpen:t,getInputProps:a,getMenuProps:i,getItemProps:c,highlightedIndex:d})=>r.a.createElement("div",null,r.a.createElement("input",Object.assign({},a(),e)),t&&!!s.length&&r.a.createElement(y,null,r.a.createElement(S,{getItemProps:c,highlightedIndex:Object(n.isNumber)(d)?d:-1,items:s.map(e=>this.toPopoverItem(e)),menuProps:i(),testId:l}),o)))}toPopoverItem(e){return Object.assign(Object.assign({},e),{content:this.highlightItem(e)})}highlightItem(e){if(!e.highlightedSlices||!e.highlightedSlices.length)return e.label;let t=0,a=0;return e.highlightedSlices.reduce((s,n,i)=>{const{label:l}=e,{offset:c,length:d}=n,m=c-t;return m&&(s.push(r.a.createElement(o.Fragment,{key:a},l.substr(t,m))),a+=1),t=c+d,s.push(r.a.createElement("strong",{key:a},l.substr(c,d))),a+=1,i===(e.highlightedSlices||[]).length-1&&(s.push(r.a.createElement(o.Fragment,{key:a},l.substr(t))),a+=1),s},[])}itemToString(e){return e&&e.value||""}}var k=A,w=(a(1457),a(660));class N{constructor(){this._scriptLoader=Object(w.getScriptLoader)()}loadMapsSdk(e){return this._googleAutoComplete||(this._googleAutoComplete=new Promise((t,a)=>{const s=["language=en","key="+e,"libraries=places","callback=initAutoComplete"].join("&");window.initAutoComplete=()=>{(function(e){const t=e;return Boolean(t.google&&t.google.maps&&t.google.maps.places)})(window)&&t(window.google.maps),a()},this._scriptLoader.loadScript("//maps.googleapis.com/maps/api/js?"+s).catch(e=>{throw this._googleAutoComplete=void 0,e})})),this._googleAutoComplete}}let I;class P{constructor(e,t=function(){return I||(I=new N),I}()){this._apiKey=e,this._scriptLoader=t}getAutocompleteService(){return this._autocompletePromise||(this._autocompletePromise=this._scriptLoader.loadMapsSdk(this._apiKey).then(e=>{if(!e.places.AutocompleteService)throw new Error("`AutocompleteService` is undefined");return new e.places.AutocompleteService})),this._autocompletePromise}getPlacesServices(){const e=document.createElement("div");return this._placesPromise||(this._placesPromise=this._scriptLoader.loadMapsSdk(this._apiKey).then(t=>{if(!t.places.PlacesService)throw new Error("`PlacesService` is undefined");return new t.places.PlacesService(e)})),this._placesPromise}}class x extends o.PureComponent{constructor(e){super(e),this.onSelect=e=>{const{fields:t,onSelect:a=n.noop,nextElement:s}=this.props;this.googleAutocompleteService.getPlacesServices().then(n=>{n.getDetails({placeId:e.id,fields:t||["address_components","name"]},t=>{s&&s.focus(),a(t,e)})})},this.onChange=e=>{const{isAutocompleteEnabled:t,onChange:a=n.noop}=this.props;if(a(e,!1),!t)return this.resetAutocomplete();this.setAutocomplete(e),this.setItems(e)},this.googleAutocompleteService=new P(e.apiKey),this.state={items:[],autoComplete:"off"}}render(){const{initialValue:e,onToggleOpen:t=n.noop,inputProps:a={}}=this.props,{autoComplete:s,items:o}=this.state;return r.a.createElement(k,{initialHighlightedIndex:0,initialValue:e,inputProps:Object.assign(Object.assign({},a),{autoComplete:s}),items:o,listTestId:"address-autocomplete-suggestions",onChange:this.onChange,onSelect:this.onSelect,onToggleOpen:t},r.a.createElement("div",{className:"co-googleAutocomplete-footer"}))}setItems(e){if(!e)return void this.setState({items:[]});const{componentRestrictions:t,types:a}=this.props;this.googleAutocompleteService.getAutocompleteService().then(s=>{s.getPlacePredictions({input:e,types:a||["geocode"],componentRestrictions:t},e=>this.setState({items:this.toAutocompleteItems(e)}))})}resetAutocomplete(){this.setState({items:[],autoComplete:"off"})}setAutocomplete(e){this.setState(Object.assign(Object.assign({},this.state),{autoComplete:e&&e.length?"nope":"off"}))}toAutocompleteItems(e){return(e||[]).map(e=>({label:e.description,value:e.structured_formatting.main_text,highlightedSlices:e.matched_substrings,id:e.place_id}))}}var F=x;var T=Object(o.memo)(({field:{default:e,name:t},countryCode:a,supportedCountries:s,parentFieldName:n,nextElement:l,apiKey:c,onSelect:d,onChange:m,onToggleOpen:u})=>{const h=n?`${n}.${t}`:t,b=Object(o.useMemo)(()=>r.a.createElement(i.a,{id:"address.address_line_1_label"}),[]),f=function(e){return p(e)+"Label"}(t),C=Object(o.useMemo)(()=>({className:"form-input optimizedCheckout-form-input",id:g(t),"aria-labelledby":f,placeholder:e}),[t,f,e]),E=Object(o.useCallback)(({field:e})=>r.a.createElement(F,{apiKey:c,componentRestrictions:a?{country:a}:void 0,initialValue:e.value,inputProps:C,isAutocompleteEnabled:!!a&&s.indexOf(a)>-1,nextElement:l,onChange:m,onSelect:d,onToggleOpen:u}),[c,a,C,l,m,d,u,s]);return r.a.createElement("div",{className:"dynamic-form-field dynamic-form-field--addressLineAutocomplete"},r.a.createElement(v.a,{input:E,label:r.a.createElement(O.a,{htmlFor:C.id,id:f},b),name:h}))});a(1456);const L={address1:"address.address_line_1_label",address2:"address.address_line_2_label",city:"address.city_label",company:"address.company_name_label",countryCode:"address.country_label",firstName:"address.first_name_label",lastName:"address.last_name_label",phone:"address.phone_number_label",postalCode:"address.postal_code_label",stateOrProvince:"address.state_label",stateOrProvinceCode:"address.state_label"},M={address1:"address-line1",address2:"address-line2",city:"address-level2",company:"organization",countryCode:"country",firstName:"given-name",lastName:"family-name",phone:"tel",postalCode:"postal-code",stateOrProvince:"address-level1",stateOrProvinceCode:"address-level1"},V={countryCode:"address.select_country_action",stateOrProvince:"address.select_state_action",stateOrProvinceCode:"address.select_state_action"};class z extends o.Component{constructor(){super(...arguments),this.containerRef=Object(o.createRef)(),this.handleDynamicFormFieldChange=Object(s.memoize)(e=>t=>{this.syncNonFormikValue(e,t)}),this.handleAutocompleteChange=(e,t)=>{t||this.syncNonFormikValue("address1",e)},this.handleAutocompleteSelect=(e,{value:t})=>{const{countries:a,setFieldValue:s=n.noop,onChange:o=n.noop}=this.props,r=C(e,a);Object(n.forIn)(r,(e,t)=>{s(t,e),o(t,e)}),t&&this.syncNonFormikValue("address1",t)},this.syncNonFormikValue=(e,t)=>{const{formFields:a,setFieldValue:s=n.noop,onChange:o=n.noop}=this.props,r=a.filter(e=>e.custom&&e.fieldType===c.a.date).map(e=>e.name);("address1"===e||r.indexOf(e)>-1)&&s(e,t),o(e,t)}}componentDidMount(){const{current:e}=this.containerRef;e&&(this.nextElement=e.querySelector('[autocomplete="address-line2"]'))}render(){const{formFields:e,fieldName:t,language:a,countriesWithAutocomplete:s,countryCode:n,googleMapsApiKey:o,onAutocompleteToggle:l,shouldShowSaveAddress:c}=this.props;return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.a,null,r.a.createElement("div",{className:"checkout-address",ref:this.containerRef},e.map(e=>{const c=e.name,d=V[c];return"address1"===c&&o&&s?r.a.createElement(T,{apiKey:o,countryCode:n,field:e,key:e.id,nextElement:this.nextElement||void 0,onChange:this.handleAutocompleteChange,onSelect:this.handleAutocompleteSelect,onToggleOpen:l,parentFieldName:t,supportedCountries:s}):r.a.createElement(m.a,{autocomplete:M[e.name],extraClass:"dynamic-form-field--"+p(c),field:e,inputId:g(c),key:`${e.id}-${e.name}`,label:e.custom?e.label:r.a.createElement(i.a,{id:L[e.name]}),onChange:this.handleDynamicFormFieldChange(c),parentFieldName:e.custom?t?t+".customFields":"customFields":t,placeholder:e.default?e.default:d&&a.translate(d)})}))),c&&r.a.createElement(u.a,{labelContent:r.a.createElement(i.a,{id:"address.save_in_addressbook"}),name:t?t+".shouldSaveAddress":"shouldSaveAddress"}))}}t.a=Object(l.a)(z)},1644:function(e,t,a){"use strict";var s=a(0),n=a.n(s),o=a(416),r=a(109),i=a(12),l=a(180),c=a(28),d=a(1460),m=a.n(d),u=a(648),h=a(166);var p=Object(u.a)(h.a,{displayNamePrefix:"withDate",pickProps:(e,t)=>"date"===t&&!!e}),g=a(1387),b=a(38),f=a.n(b),C=a(421),v=a(419);var O=Object(s.forwardRef)((e,t)=>{var{additionalClassName:a,label:s,value:o,checked:r,id:i}=e,l=Object(c.__rest)(e,["additionalClassName","label","value","checked","id"]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(C.a,Object.assign({},l,{checked:r,className:f()("form-radio","optimizedCheckout-form-radio",a),id:i,ref:t,type:"radio",value:o})),n.a.createElement(v.a,{htmlFor:i},s))}),E=a(1402),j=a(1339);var y=Object(s.memo)(p(e=>{var{additionalClassName:t,date:a,fieldType:o,id:r,name:d,onChange:u=i.noop,options:h,placeholder:p,value:b}=e,f=Object(c.__rest)(e,["additionalClassName","date","fieldType","id","name","onChange","options","placeholder","value"]);const{inputFormat:C}=a,v=Object(s.useCallback)((e,t)=>u(Object.assign(Object.assign({},t),{target:{name:d,value:e}})),[u,d]);switch(o){case l.a.dropdown:return n.a.createElement("select",Object.assign({},f,{className:"form-select optimizedCheckout-form-select","data-test":r+"-select",id:r,name:d,onChange:u,value:null===b?"":b}),p&&n.a.createElement("option",{value:""},p),h&&h.map(({label:e,value:t})=>n.a.createElement("option",{key:t,value:t},e)));case l.a.radio:return h&&h.length?n.a.createElement(n.a.Fragment,null,h.map(({label:e,value:t})=>n.a.createElement(O,Object.assign({},f,{checked:t===b,id:`${r}-${t}`,key:t,label:e,name:d,onChange:u,testId:`${r}-${t}-radio`,value:t})))):null;case l.a.checkbox:return h&&h.length?n.a.createElement(n.a.Fragment,null,h.map(({label:e,value:t})=>n.a.createElement(g.a,Object.assign({},f,{checked:!!Array.isArray(b)&&b.includes(t),id:`${r}-${t}`,key:t,label:e,name:d,onChange:u,testId:`${r}-${t}-checkbox`,value:t})))):null;case l.a.date:return n.a.createElement(m.a,Object.assign({},f,{autoComplete:"off",calendarClassName:"optimizedCheckout-contentPrimary",className:"form-input optimizedCheckout-form-input",dateFormat:C,maxDate:f.max?new Date(f.max+"T00:00:00Z"):void 0,minDate:f.min?new Date(f.min+"T00:00:00Z"):void 0,name:d,onChange:v,placeholderText:C.toUpperCase(),popperClassName:"optimizedCheckout-contentPrimary",selected:Object(i.isDate)(b)?b:void 0}));case l.a.multiline:return n.a.createElement(E.a,Object.assign({},f,{id:r,name:d,onChange:u,testId:r+"-text",type:o,value:b}));default:return n.a.createElement(j.a,Object.assign({},f,{id:r,name:d,onChange:u,placeholder:p,testId:`${r}-${o===l.a.password?"password":"text"}`,type:o,value:b}))}})),_=a(433),S=a(423);a(1414);var A=Object(s.memo)(({testId:e,onSelectedAll:t,onSelectedNone:a})=>{const r=Object(s.useCallback)(e=>{e.preventDefault(),t()},[t]),i=Object(s.useCallback)(e=>{e.preventDefault(),a()},[a]);return n.a.createElement("ul",{className:"multiCheckbox--controls"},n.a.createElement("li",{className:"multiCheckbox--control"},n.a.createElement(o.a,{id:"address.select"})),n.a.createElement("li",{className:"multiCheckbox--control"},n.a.createElement("a",{"data-test":e+"Checkbox-all-button",href:"#",onClick:r},n.a.createElement(o.a,{id:"address.select_all"}))),n.a.createElement("li",{className:"multiCheckbox--control"},n.a.createElement("a",{"data-test":e+"Checkbox-none-button",href:"#",onClick:i},n.a.createElement(o.a,{id:"address.select_none"}))))});const k=({form:{values:e,errors:t},id:a,label:o,name:c,onChange:d=i.noop,options:m,push:u,remove:h})=>{const p=Object(s.useCallback)(()=>{const t=Object(r.getIn)(e,c)||[];Object(i.difference)(m.map(({value:e})=>e),t).forEach(e=>u(e)),d(Object(r.getIn)(e,c))},[c,d,m,u,e]),g=Object(s.useCallback)(()=>{(Object(r.getIn)(e,c)||[]).forEach(()=>h(0)),d(Object(r.getIn)(e,c))},[c,d,h,e]),b=Object(s.useCallback)(t=>{const a=Object(r.getIn)(e,c)||[],{value:s,checked:n}=t.target;n?u(s):h(a.indexOf(s)),d(Object(r.getIn)(e,c))},[c,d,u,h,e]);return n.a.createElement(_.a,{hasError:Object(r.getIn)(t,c)&&Object(r.getIn)(t,c).length},o,m.length>1&&n.a.createElement(A,{onSelectedAll:p,onSelectedNone:g,testId:a}),n.a.createElement(y,{fieldType:l.a.checkbox,id:a,name:c,onChange:b,options:m,value:Object(r.getIn)(e,c)||[]}),n.a.createElement(S.a,{name:c,testId:Object(i.kebabCase)(c)+"-field-error-message"}))};var w=Object(s.memo)(({id:e,label:t,name:a,onChange:o,options:l})=>{const c=Object(s.useCallback)(s=>n.a.createElement(k,Object.assign({id:e,label:t,name:a,onChange:o,options:l},Object(i.pick)(s,["form","pop","push","remove"]))),[e,t,a,o,l]);return n.a.createElement(r.FieldArray,{name:a,render:c})}),N=a(1340);t.a=Object(s.memo)(({field:{fieldType:e,type:t,secret:a,name:r,label:i,required:c,options:d,max:m,min:u,maxLength:h},parentFieldName:p,onChange:g,placeholder:b,inputId:f,autocomplete:C,label:O,extraClass:E})=>{const j=f||r,_=p?`${p}.${r}`:r,S=Object(s.useMemo)(()=>n.a.createElement(v.a,{htmlFor:j},O||i,!c&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement("small",{className:"optimizedCheckout-contentSecondary"},n.a.createElement(o.a,{id:"common.optional_text"})))),[j,i,c,O]),A=Object(s.useMemo)(()=>"text"===e?"integer"===t?l.a.number:a?l.a.password:l.a.text:e,[e,t,a]),k=Object(s.useCallback)(({field:e})=>n.a.createElement(y,Object.assign({},e,{autoComplete:C,fieldType:A,id:j,max:m,maxLength:h||void 0,min:u,options:d&&d.items,placeholder:b||d&&d.helperLabel,rows:d&&d.rows})),[j,m,h,u,d,b,A,C]);return n.a.createElement("div",{className:"dynamic-form-field "+E},e===l.a.checkbox?n.a.createElement(w,{id:j,label:S,name:_,onChange:g,options:d&&d.items||[]}):n.a.createElement(N.a,{input:k,label:S,name:_,onChange:g}))})},1660:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(28),n=a(1507);function o(e){const{customFields:t}=e,a=Object(s.__rest)(e,["customFields"]),o=e.shouldSaveAddress;return Object.assign(Object.assign({},a),{shouldSaveAddress:o,customFields:Object(n.a)(t)})}},1661:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(12),n=a(1410),o=a(443);function r(e,t,a){return!(!e||!Object(o.a)(e,a))&&Object(s.some)(t,t=>Object(n.a)(t,e))}},1662:function(e,t,a){"use strict";var s=a(0),n=a.n(s),o=a(1329),r=a(416),i=a(1508),l=a(1410),c=(a(1450),a(666));class d extends s.PureComponent{constructor(){super(...arguments),this.handleSelectAddress=e=>{const{onSelectAddress:t,selectedAddress:a}=this.props;Object(l.a)(a,e)||t(e)},this.handleUseNewAddress=()=>{const{selectedAddress:e,onUseNewAddress:t}=this.props;t(e)}}render(){const{addresses:e,selectedAddress:t}=this.props;return n.a.createElement("div",{className:"form-field"},n.a.createElement("div",{className:"dropdown--select",role:"combobox"},n.a.createElement(i.a,{dropdown:n.a.createElement(m,{addresses:e,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:t})},n.a.createElement(u,{addresses:e,selectedAddress:t}))))}}const m=({addresses:e,onSelectAddress:t,onUseNewAddress:a,selectedAddress:s})=>n.a.createElement("ul",{className:"dropdown-menu instrumentSelect-dropdownMenu",id:"addressDropdown"},n.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select"},n.a.createElement("a",{"data-test":"add-new-address",href:"#",onClick:Object(o.a)(()=>a(s))},n.a.createElement(r.a,{id:"address.enter_address_action"}))),e.map(e=>n.a.createElement("li",{className:"dropdown-menu-item dropdown-menu-item--select",key:e.id},n.a.createElement("a",{href:"#",onClick:Object(o.a)(()=>t(e))},n.a.createElement(c.a,{address:e}))))),u=({selectedAddress:e})=>n.a.createElement("a",{className:"button dropdown-button dropdown-toggle--select",href:"#",id:"addressToggle",onClick:Object(o.a)()},e?n.a.createElement(c.a,{address:e}):n.a.createElement(r.a,{id:"address.enter_address_action"}));t.a=Object(s.memo)(d)},1683:function(e,t,a){"use strict";var s=a(0),n=a.n(s),o=a(416),r=a(419),i=a(1339),l=a(1368),c=a(1367),d=a(1340);t.a=()=>{const e=Object(s.useCallback)(e=>n.a.createElement(r.a,{hidden:!0,htmlFor:e},n.a.createElement(o.a,{id:"shipping.order_comment_label"})),[]),t=Object(s.useCallback)(({field:e})=>n.a.createElement(i.a,Object.assign({},e,{autoComplete:"off",maxLength:2e3})),[]),a=Object(s.useMemo)(()=>n.a.createElement(l.a,null,n.a.createElement(o.a,{id:"shipping.order_comment_label"})),[]);return n.a.createElement(c.a,{legend:a,testId:"checkout-shipping-comments"},n.a.createElement(d.a,{input:t,label:e,name:"orderComment"}))}},1684:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var s=a(647),n=a(1366);function o(e){return(e&&e.payments?e.payments:[]).find(e=>!Object(s.a)(e)&&!Object(n.a)(e)&&!!e.providerId)}},1810:function(e,t,a){"use strict";a.r(t);var s=a(28),n=a(12),o=a(0),r=a.n(o),i=a(1660),l=a(1410),c=a(415),d=a(1332),m=a(416),u=a(1471),h=a(1368),p=a(1360),g=a(1684);function b(e){const t=Object(g.a)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var f=a(109),C=a(67),v=a(1661),O=a(1662),E=a(1640),j=a(645),y=a(633),_=a(644),S=a(292),A=a(1683),k=a(1359),w=a(1369),N=a(1367),I=a(1345);class P extends o.PureComponent{constructor(){super(...arguments),this.state={isResettingAddress:!1},this.addressFormRef=Object(o.createRef)(),this.handleSelectAddress=e=>Object(s.__awaiter)(this,void 0,void 0,(function*(){const{updateAddress:t,onUnhandledError:a}=this.props;this.setState({isResettingAddress:!0});try{yield t(e)}catch(e){a(e)}finally{this.setState({isResettingAddress:!1})}})),this.handleUseNewAddress=()=>{this.handleSelectAddress({})}}render(){const{googleMapsApiKey:e,billingAddress:t,countriesWithAutocomplete:a,customer:{addresses:s,isGuest:n},getFields:o,countries:i,isUpdating:l,setFieldValue:c,shouldShowOrderComments:d,values:u,methodId:h}=this.props,g="amazonpay"===h,b=o(u.countryCode),f=b.filter(({custom:e})=>e),C=f.length>0,j=g&&C?f:b,{isResettingAddress:y}=this.state,_=s&&s.length>0,S=t&&Object(v.a)(t,s,o(t.countryCode));return r.a.createElement(w.a,{autoComplete:"on"},g&&t&&r.a.createElement("div",{className:"form-fieldset"},r.a.createElement(I.a,{address:t})),r.a.createElement(N.a,{id:"checkoutBillingAddress",ref:this.addressFormRef},_&&!g&&r.a.createElement(N.a,{id:"billingAddresses"},r.a.createElement(p.a,{isLoading:y},r.a.createElement(O.a,{addresses:s,onSelectAddress:this.handleSelectAddress,onUseNewAddress:this.handleUseNewAddress,selectedAddress:S?t:void 0}))),!S&&r.a.createElement(p.a,{isLoading:y},r.a.createElement(E.a,{countries:i,countriesWithAutocomplete:a,countryCode:u.countryCode,formFields:j,googleMapsApiKey:e,setFieldValue:c,shouldShowSaveAddress:!n}))),d&&r.a.createElement(A.a,null),r.a.createElement("div",{className:"form-actions"},r.a.createElement(k.c,{disabled:l||y,id:"checkout-billing-continue",isLoading:l||y,type:"submit",variant:k.b.Primary},r.a.createElement(m.a,{id:"common.continue_action"}))))}}var x=Object(S.a)(Object(f.withFormik)({handleSubmit:(e,{props:{onSubmit:t}})=>{t(e)},mapPropsToValues:({getFields:e,customerMessage:t,billingAddress:a})=>Object.assign(Object.assign({},Object(j.a)(e(a&&a.countryCode),a)),{orderComment:t}),isInitialValid:({billingAddress:e,getFields:t,language:a})=>!!e&&Object(y.a)({language:a,formFields:t(e.countryCode)}).isValidSync(e),validationSchema:({language:e,getFields:t,methodId:a})=>"amazonpay"===a?Object(C.lazy)(a=>Object(_.a)({translate:Object(y.b)(e),formFields:t(a&&a.countryCode)})):Object(C.lazy)(a=>Object(y.a)({language:e,formFields:t(a&&a.countryCode)})),enableReinitialize:!0})(P));class F extends o.Component{constructor(){super(...arguments),this.handleSubmit=e=>Object(s.__awaiter)(this,void 0,void 0,(function*(){var{orderComment:t}=e,a=Object(s.__rest)(e,["orderComment"]);const{updateAddress:n,updateCheckout:o,customerMessage:r,billingAddress:c,navigateNextStep:d,onUnhandledError:m}=this.props,u=[],h=Object(i.a)(a);h&&!Object(l.a)(h,c)&&u.push(n(h)),r!==t&&u.push(o({customerMessage:t}));try{yield Promise.all(u),d()}catch(e){m(e)}}))}componentDidMount(){return Object(s.__awaiter)(this,void 0,void 0,(function*(){const{initialize:e,onReady:t=n.noop,onUnhandledError:a}=this.props;try{yield e(),t()}catch(e){a(e)}}))}render(){const e=this.props,{updateAddress:t,isInitializing:a}=e,n=Object(s.__rest)(e,["updateAddress","isInitializing"]);return r.a.createElement("div",{className:"checkout-form"},r.a.createElement("div",{className:"form-legend-container"},r.a.createElement(h.a,{testId:"billing-address-heading"},r.a.createElement(m.a,{id:"billing.billing_address_heading"}))),r.a.createElement(p.a,{isLoading:a,unmountContentWhenLoading:!0},r.a.createElement(x,Object.assign({},n,{onSubmit:this.handleSubmit,updateAddress:t}))))}}t.default=Object(c.a)((function({checkoutService:e,checkoutState:t}){const{data:{getCheckout:a,getConfig:s,getCart:n,getCustomer:o,getBillingAddress:r,getBillingAddressFields:i,getBillingCountries:l},statuses:{isLoadingBillingCountries:c,isUpdatingBillingAddress:m,isUpdatingCheckout:h}}=t,p=s(),g=o(),f=a(),C=n();if(!(p&&g&&f&&C))return null;const{enableOrderComments:v,googleMapsApiKey:O,features:E}=p.checkoutSettings,j=["US","CA","AU","NZ"];return E["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&j.push("GB"),{billingAddress:r(),countries:l()||d.a,countriesWithAutocomplete:j,customer:g,customerMessage:f.customerMessage,getFields:i,googleMapsApiKey:O,initialize:e.loadBillingAddressFields,isInitializing:c(),isUpdating:m()||h(),methodId:b(f),shouldShowOrderComments:v&&Object(u.a)(C)<1,updateAddress:e.updateBillingAddress,updateCheckout:e.updateCheckout}}))(F)}}]);
//# sourceMappingURL=billing-d5e7739e.js.map